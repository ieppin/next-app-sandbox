version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 16
    commands:
      - echo ${BUILD_ENV}
      - npm ci
  build:
    commands:
      - npm run build
      # Static resources ideally served from CloudFront
      - cp -r public/. .next/standalone/public
      - cp -r .next/static/. .next/standalone/.next/static
      # Copy artifacts for deployment
      - mkdir dist
      - cp -r .next/standalone/. dist
      - cp run.sh dist
      - sam package --template-file template.yaml --s3-bucket ${SAM_BUCKET} --output-template-file packaged-template.yml
cache:
  paths:
    - .next/cache/**/*
